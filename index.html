<!DOCTYPE html>
<html manifest="index.appcache">
<head>
<title>PicDemo</title>
<meta charset='utf-8'/>
<meta name='format-detection' content='telephone=no' />
<meta name='viewport' content='width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1, maximum-scale=1'/>
<meta name='apple-mobile-web-app-cabable' content='YES'/>
<meta name='keywords' content='JQM.Show,JQuery Mobile,JQuery,JavaScript,Anele Mbanga,Mobile,Hybrid,HTML,CSS,Responsive,HTML5'/>
<meta name='mobile-web-app-capable' content='yes'/>
<meta name='apple-mobile-web-app-title' content='PicDemo'/>
<meta name='apple-mobile-web-app-status-bar-style' content='black-translucent.'/>
<meta name='version' content='1.00' />
<meta name='generator' content='JQM.Show 1.00' />
<meta name='date' content='2015-02-24 03:03' />
<meta name='copyright' content='Anele Mbanga' />
<meta name='author' content='Anele Mbanga' />
<meta name='email' content='anele@mbangas.com' />
<meta name='website' content='' />
<meta name='description' content='Demonstrating taking pictures with Cordova.' />
<link rel="apple-touch-icon" href="apps.png">
<link rel="icon" type="image/png" href="apps.png">
<link rel="shortcut icon" type="image/png" href="apps.png">
<link rel="apple-touch-icon" sizes="57x57" href="apps57.png">
<link rel="apple-touch-icon" sizes="72x72" href="apps72.png">
<link rel="apple-touch-icon" sizes="80x80" href="apps80.png">
<link rel="apple-touch-icon" sizes="114x114" href="apps114.png">
<link rel="apple-touch-icon-precomposed" href="appsIconPreComposed.png">
<link rel="apple-touch-startup-image" href="appsIconStartUp320by460.png">
<link rel="stylesheet" href="jquerym.css">
<link rel="stylesheet" href="listview-grid.css">
<script src="jquery.js" type="text/javascript"></script>
<script src="jquerym.js" type="text/javascript"></script>
<script src="fastclick.js" type="text/javascript"></script>
<!--[if IE]>
<script src="html5.js" type="text/javascript"></script>
<![endif]-->
<script src="cordova.js" type="text/javascript"></script>
<style>.ui-header .ui-title, .ui-footer .ui-title {margin-right: 0 !important; margin-left: 0 !important;}
marker {max-width: 100%; max-height: 100%;}
</style>
</head>
<body><div id="pgMenu" data-role="page" data-themeAddAttribute="b" class="my-page">

<header id="pgMenuheader" data-role="header" data-position="fixed">
<h1>PicDemo</h1>
</header>
<div id="pgMenucontent" data-role="content" class="content">
<ul data-role="listview" data-inset="true" id="sbItems">
<li data-icon="false"><a data-transition="slide" id="sbLocation" href="#pgLocation"><h2>Locations</h2><p>Maintain Locations</p><label id="lbl"></label><img height="200" width="100%" src="appblue.png" alt="Locations" class="ui-li-thumb"></img></a></li>
<li data-icon="false"><a data-transition="slide" id="sbPicture" href="#pgPicture"><h2>Pictures</h2><p>Maintain Pictures</p><label id="lbl"></label><img height="200" width="100%" src="appblue.png" alt="Pictures" class="ui-li-thumb"></img></a></li>
</ul>
</div>

<footer id="pgMenufooter" data-role="footer" data-position="fixed">
<h1>Powered by JQM.Show © Anele Mbanga 2015</h1>
</footer></div>
<div id="pgLocation" data-role="page">

<header id="pgLocationheader" data-role="header" data-position="fixed">
<h1>Locations</h1>
<a data-role="button" id="pgLocationBack" data-icon="arrow-l" class="ui-btn-left">Back</a>
<a data-role="button" id="pgLocationNew" data-icon="plus" data-theme="b" class="ui-btn-right">New</a>
</header>
<div id="pgLocationcontent" data-role="content" class="content">
<ul data-role="listview" data-inset="true" id="pgLocationList" data-autodividers="true" data-filter="true" data-filter-placeholder="Search Locations" data-filter-reveal="false">
<li data-role="list-divider">LocationHdr</li>
<li id="noLocation">You have no locations</li>

</ul>
</div>

</div>

<div id="pgAddLocation" data-role="page">

<header id="pgAddLocationheader" data-role="header" data-position="fixed">
<h1>Add Location</h1>
<a data-role="button" id="pgAddLocationBack" data-icon="arrow-l" class="ui-btn-left">Back</a>
</header>
<div id="pgAddLocationcontent" data-role="content" class="content">
<form action="/" method="post">
<div data-role="fieldcontain">
<label for="pgAddLocationTitle" id="lblpgAddLocationTitle">Title<span style='color:red;'>*</span></label>
<input type="text" required="required" title="Enter title here." name="pgAddLocationTitle" id="pgAddLocationTitle" placeholder="Enter title here." data-clear-btn="true" value=""></input>
</div>
<div data-role="fieldcontain">
<label for="pgAddLocationLoc" id="lblpgAddLocationLoc">Location<span style='color:red;'>*</span></label>

<div><button id="pgAddLocationLocGetLoc" class="ui-btn ui-corner-all ui-shadow">Get My Location</button>
</div>

<div><button id="pgAddLocationLocShowLoc" class="ui-btn ui-corner-all ui-shadow">Show My Location</button>
</div>
<div data-role="fieldcontain">
<label for="pgAddLocationLocLat" id="lblpgAddLocationLocLat">Latitude<span style='color:red;'>*</span></label>
<input type="text" required="required" title="Your latitude" name="pgAddLocationLocLat" id="pgAddLocationLocLat" placeholder="Your latitude" value=""></input>
</div>
<div data-role="fieldcontain">
<label for="pgAddLocationLocLng" id="lblpgAddLocationLocLng">Longitude<span style='color:red;'>*</span></label>
<input type="text" required="required" title="Your longitude" name="pgAddLocationLocLng" id="pgAddLocationLocLng" placeholder="Your longitude" value=""></input>
</div>
<div data-role="fieldcontain">
<div style="width:100%;height:300px;" id="pgAddLocationLocmap">
</div>
</div>
</div>
<div><button type="submit" id="pgAddLocationSave" class="ui-btn ui-corner-all ui-shadow ui-btn-b">Save Location</button>
</div>
</form>
</div>

</div>

<div data-url="Title" id="pgEditLocation" data-role="page">

<header id="pgEditLocationheader" data-role="header" data-position="fixed">
<h1>Edit Location</h1>
<a data-role="button" id="pgEditLocationBack" data-icon="arrow-l" class="ui-btn-left">Back</a>
<a data-role="button" data-href="ID" id="pgEditLocationDelete" data-icon="delete" data-theme="b" class="ui-btn-right">Delete</a>
</header>
<div id="pgEditLocationcontent" data-role="content" class="content">
<form action="/" method="post">
<div data-role="fieldcontain">
<label for="pgEditLocationTitle" id="lblpgEditLocationTitle">Title<span style='color:red;'>*</span></label>
<input readonly="readonly" data-clear-btn="true" autofocus="true" type="text" required="required" title="Enter title here." name="pgEditLocationTitle" id="pgEditLocationTitle" placeholder="Enter title here." value=""></input>
</div>
<div data-role="fieldcontain">
<label for="pgEditLocationLoc" id="lblpgEditLocationLoc">Location<span style='color:red;'>*</span></label>

<div><button id="pgEditLocationLocGetLoc" class="ui-btn ui-corner-all ui-shadow">Get My Location</button>
</div>

<div><button id="pgEditLocationLocShowLoc" class="ui-btn ui-corner-all ui-shadow">Show My Location</button>
</div>
<div data-role="fieldcontain">
<label for="pgEditLocationLocLat" id="lblpgEditLocationLocLat">Latitude<span style='color:red;'>*</span></label>
<input type="text" required="required" title="Your latitude" name="pgEditLocationLocLat" id="pgEditLocationLocLat" placeholder="Your latitude" value=""></input>
</div>
<div data-role="fieldcontain">
<label for="pgEditLocationLocLng" id="lblpgEditLocationLocLng">Longitude<span style='color:red;'>*</span></label>
<input type="text" required="required" title="Your longitude" name="pgEditLocationLocLng" id="pgEditLocationLocLng" placeholder="Your longitude" value=""></input>
</div>
<div data-role="fieldcontain">
<div style="width:100%;height:300px;" id="pgEditLocationLocmap">
</div>
</div>
</div>
<div><button type="submit" id="pgEditLocationUpdate" class="ui-btn ui-corner-all ui-shadow ui-btn-b">Update Location</button>
</div>
</form>
</div>

</div>
<div id="pgPicture" data-role="page">

<header id="pgPictureheader" data-role="header" data-position="fixed">
<h1>Pictures</h1>
<a data-role="button" id="pgPictureBack" data-icon="arrow-l" class="ui-btn-left">Back</a>
<a data-role="button" id="pgPictureNew" data-icon="plus" data-theme="b" class="ui-btn-right">New</a>
</header>
<div id="pgPicturecontent" data-role="content" class="content">
<ul data-role="listview" data-inset="true" id="pgPictureList" data-autodividers="true" data-filter="true" data-filter-placeholder="Search Pictures" data-filter-reveal="false">
<li data-role="list-divider">PictureHdr</li>
<li id="noPicture">You have no pictures</li>

</ul>
</div>

</div>

<div id="pgAddPicture" data-role="page">

<header id="pgAddPictureheader" data-role="header" data-position="fixed">
<h1>Add Picture</h1>
<a data-role="button" id="pgAddPictureBack" data-icon="arrow-l" class="ui-btn-left">Back</a>
</header>
<div id="pgAddPicturecontent" data-role="content" class="content">
<form action="/" method="post">
<div data-role="fieldcontain">
<label for="pgAddPictureTitle" id="lblpgAddPictureTitle">Title<span style='color:red;'>*</span></label>
<input type="text" required="required" title="Enter title here." name="pgAddPictureTitle" id="pgAddPictureTitle" placeholder="Enter title here." data-clear-btn="true" value=""></input>
</div>
<div data-role="fieldcontain">
<label for="pgAddPictureImage" id="lblpgAddPictureImage">Image<span style='color:red;'>*</span></label>

<div><button id="pgAddPictureImageTakePicture" class="ui-btn ui-corner-all ui-shadow">Take Picture</button>
</div>
<img id="pgAddPictureImage" height="300" width="100%" src="apps.png" alt="Apps"></img>
</div>
<div><button type="submit" id="pgAddPictureSave" class="ui-btn ui-corner-all ui-shadow ui-btn-b">Save Picture</button>
</div>
</form>
</div>

</div>

<div data-url="Title" id="pgEditPicture" data-role="page">

<header id="pgEditPictureheader" data-role="header" data-position="fixed">
<h1>Edit Picture</h1>
<a data-role="button" id="pgEditPictureBack" data-icon="arrow-l" class="ui-btn-left">Back</a>
<a data-role="button" data-href="ID" id="pgEditPictureDelete" data-icon="delete" data-theme="b" class="ui-btn-right">Delete</a>
</header>
<div id="pgEditPicturecontent" data-role="content" class="content">
<form action="/" method="post">
<div data-role="fieldcontain">
<label for="pgEditPictureTitle" id="lblpgEditPictureTitle">Title<span style='color:red;'>*</span></label>
<input readonly="readonly" data-clear-btn="true" autofocus="true" type="text" required="required" title="Enter title here." name="pgEditPictureTitle" id="pgEditPictureTitle" placeholder="Enter title here." value=""></input>
</div>
<div data-role="fieldcontain">
<label for="pgEditPictureImage" id="lblpgEditPictureImage">Image<span style='color:red;'>*</span></label>

<div><button id="pgEditPictureImageTakePicture" class="ui-btn ui-corner-all ui-shadow">Take Picture</button>
</div>
<img id="pgEditPictureImage" height="300" width="100%" src="apps.png" alt="Apps"></img>
</div>
<div><button type="submit" id="pgEditPictureUpdate" class="ui-btn ui-corner-all ui-shadow ui-btn-b">Update Picture</button>
</div>
</form>
</div>

</div>
<section data-transition="pop" id="msgbox" data-role="dialog">

<header id="msgboxheader" data-role="header" data-position="fixed">
<h1>Confirm</h1>
</header>
<div id="msgboxcontent" data-role="content" class="content">
<div id="msgboxtitle">
</div>
<br><div id="msgboxprompt">
<p>Are you sure you want to delete this record?</p>
</div>
<br><div style="text-align: center;" id="msgboxbuttons" class="ui-grid-a">
<div class="ui-block-a">
<a data-method="" data-id="" data-topage="" id="msgboxyes" data-role="button" data-icon="check">Yes</a>
</div>
<div class="ui-block-b">
<a data-method="" data-id="" data-topage="" id="msgboxno" data-role="button" data-icon="delete" data-theme="b">No</a>
</div>
</div>
</div>

</section>
<section data-transition="pop" id="alertbox" data-role="dialog">

<header id="alertboxheader" data-role="header" data-position="fixed">
<h1>Error</h1>
</header>
<div id="alertboxcontent" data-role="content" class="content">
<div id="alertboxtitle">
</div>
<br><div id="alertboxprompt">
<p>An error has been encountered!</p>
</div>
<br><div style="text-align: center;" id="alertboxbuttons" class="ui-grid-solo">
<div class="ui-block-a">
<a data-method="" data-id="" data-topage="" id="alertboxok" data-role="button" data-icon="check" data-theme="b">Ok</a>
</div>
</div>
</div>

</section>
<script>$(function(){
// define the application
var PicDemo = {};
var pictureSource;
var destinationType;
var isPhoneGapReady = false;
(function(app){
// variable definitions go here
var LocationLi = '<li ><a href="#pgEditLocation?Title=LINK">ID</a></li>';
var LocationHdr = '<li data-role="list-divider">LocationHdr</li>';
var noLocation = '<li id="noLocation">You have no locations</li>';

// variable definitions go here
var PictureLi = '<li ><a href="#pgEditPicture?Title=LINK">ID</a></li>';
var PictureHdr = '<li data-role="list-divider">PictureHdr</li>';
var noPicture = '<li id="noPicture">You have no pictures</li>';


app.init = function(){
FastClick.attach(document.body);
app.BindDevice();
app.Locationsbindings();
app.checkForLocationsStorage();
app.Picturesbindings();
app.checkForPicturesStorage();
$('#msgboxyes').on('click', function(e){
e.preventDefault();
e.stopImmediatePropagation();
var yesmethod = $('#msgboxyes').data('method');
var yesid = $('#msgboxyes').data('id');
app[yesmethod](yesid);
});

$('#msgboxno').on('click', function(e){
e.preventDefault();
e.stopImmediatePropagation();
var toPage = $('#msgboxno').data('topage');
// show the page to display after a record is deleted
$.mobile.changePage('#'+toPage, {transition: 'slide'});
});

$('#alertboxok').on('click', function(e){
e.preventDefault();
e.stopImmediatePropagation();
var toPage = $('#alertboxok').data('topage');
// show the page to display after ok is clicked
$.mobile.changePage('#'+toPage, {transition: 'slide'});
});

$(document).on('click', '#sbItems a', function(e){
e.preventDefault();
e.stopImmediatePropagation();
var href = $(this).attr('href');
$.mobile.changePage(href, {transition: 'slide'});
});

};

app.Locationsbindings = function(){
$(document).on('click', '#pgLocationList a', function(e){
e.preventDefault();
e.stopImmediatePropagation();
var href = $(this)[0].href.match(/\?.*$/)[0];
var Title = href.replace(/^\?Title=/,'');
$.mobile.changePage('#pgEditLocation', {transition: 'slide'});
app.editLocation(Title);
});

$(document).on('pagebeforechange', function(e, data){
var toPage = data.toPage[0].id;
if(toPage == 'pgLocation'){
// restart the storage check
app.checkForLocationsStorage();
}
});

// bind the back button of the list
$('#pgLocationBack').on('click', function(e){
e.preventDefault();
e.stopImmediatePropagation();
// move to the add new record screen
$.mobile.changePage('#pgMenu', {transition: 'slide'});
});
// click new on listing page
$('#pgLocationNew').on('click', function(e){
e.preventDefault();
e.stopImmediatePropagation();
$('#pgAddLocation').data('from', pgLocation);
// move to the add new record screen
$.mobile.changePage('#pgAddLocation', {transition: 'slide'});
});
// click back button of new record page
$('#pgAddLocationBack').on('click', function(e){
e.preventDefault();
e.stopImmediatePropagation();
//which page are we coming from, if from sign in go back to it
var pgFrom = $('#pgAddLocation').data('from');
switch (pgFrom) {
case "pgSignIn":
$.mobile.changePage('#pgSignIn', {transition: 'slide'});
break;
default:
// go back to the listing screen
$.mobile.changePage('#pgLocation', {transition: 'slide'});
}
});
// click save button of new record
$('#pgAddLocationSave').on('click', function(e){
e.preventDefault();
e.stopImmediatePropagation();
// save the Location
var LocationRec;
LocationRec = pgAddLocationGetRec();
app.addLocation(LocationRec);
});
// click back button of edit record page
$('#pgEditLocationBack').on('click', function(e){
e.preventDefault();
e.stopImmediatePropagation();
// go back to the listing screen
$.mobile.changePage('#pgLocation', {transition: 'slide'});
});
// click update when editing a record
$('#pgEditLocationUpdate').on('click', function(e){
e.preventDefault();
e.stopImmediatePropagation();
// save the Location
var LocationRecNew;
LocationRecNew = pgEditLocationGetRec();
app.updateLocation(LocationRecNew);
});
// click delete on edit page
$('#pgEditLocationDelete').on('click', function(e){
e.preventDefault();
e.stopImmediatePropagation();
var Title = $('#pgEditLocationTitle').val();
Title = Title.replace(/-/g,' ');
Title = Title.replace(/-/g,' ');
$('#msgboxheader h1').text('Confirm Delete');
$('#msgboxtitle').text(Title);
$('#msgboxprompt').text('Are you sure that you want to delete this location?');
$('#msgboxyes').data('method', 'deleteLocation');
Title = Title.replace(/ /g,'-');
$('#msgboxyes').data('id', Title);
$('#msgboxno').data('topage', 'pgEditLocation');
$.mobile.changePage('#msgbox', {transition: 'pop'});
});



$('#pgAddLocationLocGetLoc').on('click', function(e){
e.preventDefault();
e.stopImmediatePropagation();
app.pgAddLocationLocGetLoc();
});
$('#pgAddLocationLocShowLoc').on('click', function(e){
e.preventDefault();
e.stopImmediatePropagation();
app.pgAddLocationLocShowLoc();
});

$('#pgEditLocationLocGetLoc').on('click', function(e){
e.preventDefault();
e.stopImmediatePropagation();
app.pgEditLocationLocGetLoc();
});
$('#pgEditLocationLocShowLoc').on('click', function(e){
e.preventDefault();
e.stopImmediatePropagation();
app.pgEditLocationLocShowLoc();
});

};
//get the record to be saved and put it in a record array
function pgAddLocationGetRec(){
//define the new record
var LocationRec
LocationRec = {};
LocationRec.Title = $('#pgAddLocationTitle').val();
LocationRec.Loc = $('#pgAddLocationLoc').val();
return LocationRec;
}

//get the record to be saved and put it in a record array
function pgEditLocationGetRec(){
//define the new record
var LocationRec
LocationRec = {};
LocationRec.Title = $('#pgEditLocationTitle').val();
LocationRec.Loc = $('#pgEditLocationLoc').val();
return LocationRec;
}

//clear the forms for new data entry
function pgAddLocationClear(){
$('#pgAddLocationTitle').val('');
$('#pgAddLocationLoc').val('');
}

//clear the forms for new data entry
function pgEditLocationClear(){
$('#pgEditLocationTitle').val('');
$('#pgEditLocationLoc').val('');
}



//get the picture location
app.pgAddLocationLocGetLoc = function(){
// get the user's gps coordinates and display map
//check if geolocation is supported first
var mapObj = document.getElementById('pgAddLocationLocmap');
if (!navigator.geolocation){
mapObj.innerHTML = '<p>Geolocation Is Not supported by your browser</p>';
$('#pgAddLocationLocLat').val();
$('#pgAddLocationLocLng').val();
return;
}
mapObj.innerHTML = '<p>Locating…</p>';
// geolocation exists, find the location
var options = {};
options.maximumAge = 3000;
options.timeout = 5000;
options.enableHighAccuracy = true;
navigator.geolocation.getCurrentPosition(app.pgAddLocationLocLoadMap, app.pgAddLocationLocGeoError, options);
};
//load the user co-ordinates
app.pgAddLocationLocLoadMap = function(position){
var latitude = position.coords.latitude;
var longitude = position.coords.longitude;
$('#pgAddLocationLocLat').val(latitude);

$('#pgAddLocationLocLng').val(longitude);

var mapObj = document.getElementById('pgAddLocationLocmap');
var img = new Image();
img.class = 'marker';
img.src = "http://maps.googleapis.com/maps/api/staticmap?center=" + latitude + "," + longitude + "&maptype=roadmap&zoom=15&size=600x300&sensor=false";
mapObj.innerHTML = '<p>Your Position</p>';
mapObj.appendChild(img);
};
// show error when we cant get the map.
app.pgAddLocationLocGeoError = function(){
var mapObj = document.getElementById('pgAddLocationLocmap');
mapObj.innerHTML = 'Unable To retrieve your location';
$('#pgAddLocationLocLat').val();
$('#pgAddLocationLocLng').val();
};
//show the location
app.pgAddLocationLocShowLoc = function(){
// get the user's gps coordinates and display map
//check if geolocation is supported first
var mapObj = document.getElementById('pgAddLocationLocmap');
if (!navigator.geolocation){
mapObj.innerHTML = '<p>Geolocation Is Not supported by your browser</p>';
return;
}
mapObj.innerHTML = '<p>Locating…</p>';
// geolocation exists, find the location
var latitude = $('#pgAddLocationLocLat').val();
var longitude = $('#pgAddLocationLocLng').val();
app.pgAddLocationLocShowMap(latitude,longitude);
};
//load the user co-ordinates
app.pgAddLocationLocShowMap = function(latitude,longitude){
var mapObj = document.getElementById('pgAddLocationLocmap');
var img = new Image();
img.class = 'marker';
img.src = "http://maps.googleapis.com/maps/api/staticmap?center=" + latitude + "," + longitude + "&maptype=roadmap&zoom=15&size=600x300&sensor=false";
mapObj.innerHTML = '<p>Your Position</p>';
mapObj.appendChild(img);
};
// show error when we cant get the map.
app.pgAddLocationLocGeoError = function(){
var mapObj = document.getElementById('pgAddLocationLocmap');
mapObj.innerHTML = 'Unable To retrieve your location';
$('#pgAddLocationLocLat').val();
$('#pgAddLocationLocLng').val();
};

//get the picture location
app.pgEditLocationLocGetLoc = function(){
// get the user's gps coordinates and display map
//check if geolocation is supported first
var mapObj = document.getElementById('pgEditLocationLocmap');
if (!navigator.geolocation){
mapObj.innerHTML = '<p>Geolocation Is Not supported by your browser</p>';
$('#pgEditLocationLocLat').val();
$('#pgEditLocationLocLng').val();
return;
}
mapObj.innerHTML = '<p>Locating…</p>';
// geolocation exists, find the location
var options = {};
options.maximumAge = 3000;
options.timeout = 5000;
options.enableHighAccuracy = true;
navigator.geolocation.getCurrentPosition(app.pgEditLocationLocLoadMap, app.pgEditLocationLocGeoError, options);
};
//load the user co-ordinates
app.pgEditLocationLocLoadMap = function(position){
var latitude = position.coords.latitude;
var longitude = position.coords.longitude;
$('#pgEditLocationLocLat').val(latitude);

$('#pgEditLocationLocLng').val(longitude);

var mapObj = document.getElementById('pgEditLocationLocmap');
var img = new Image();
img.class = 'marker';
img.src = "http://maps.googleapis.com/maps/api/staticmap?center=" + latitude + "," + longitude + "&maptype=roadmap&zoom=15&size=600x300&sensor=false";
mapObj.innerHTML = '<p>Your Position</p>';
mapObj.appendChild(img);
};
// show error when we cant get the map.
app.pgEditLocationLocGeoError = function(){
var mapObj = document.getElementById('pgEditLocationLocmap');
mapObj.innerHTML = 'Unable To retrieve your location';
$('#pgEditLocationLocLat').val();
$('#pgEditLocationLocLng').val();
};
//show the location
app.pgEditLocationLocShowLoc = function(){
// get the user's gps coordinates and display map
//check if geolocation is supported first
var mapObj = document.getElementById('pgEditLocationLocmap');
if (!navigator.geolocation){
mapObj.innerHTML = '<p>Geolocation Is Not supported by your browser</p>';
return;
}
mapObj.innerHTML = '<p>Locating…</p>';
// geolocation exists, find the location
var latitude = $('#pgEditLocationLocLat').val();
var longitude = $('#pgEditLocationLocLng').val();
app.pgEditLocationLocShowMap(latitude,longitude);
};
//load the user co-ordinates
app.pgEditLocationLocShowMap = function(latitude,longitude){
var mapObj = document.getElementById('pgEditLocationLocmap');
var img = new Image();
img.class = 'marker';
img.src = "http://maps.googleapis.com/maps/api/staticmap?center=" + latitude + "," + longitude + "&maptype=roadmap&zoom=15&size=600x300&sensor=false";
mapObj.innerHTML = '<p>Your Position</p>';
mapObj.appendChild(img);
};
// show error when we cant get the map.
app.pgEditLocationLocGeoError = function(){
var mapObj = document.getElementById('pgEditLocationLocmap');
mapObj.innerHTML = 'Unable To retrieve your location';
$('#pgEditLocationLocLat').val();
$('#pgEditLocationLocLng').val();
};

app.addLocation = function(LocationRec){
// get Location records.
var LocationsObj = app.getLocations();
// define a record object to store the current details
var Title = LocationRec.Title;
Title = Title.replace(/ /g,'-');
LocationsObj[Title] = LocationRec;
localStorage['picdemo-locations'] = JSON.stringify(LocationsObj);
// clear the form fields
pgAddLocationClear();
//which page are we coming from, if from sign in go back to it
var pgFrom = $('#pgAddLocation').data('from');
switch (pgFrom) {
case "pgSignIn":
$.mobile.changePage('#pgSignIn', {transition: 'slide'});
break;
}
};

app.editLocation = function(Title){
// get Location records.
var LocationsObj = app.getLocations();
// lookup specific Location
Title = Title.replace(/ /g,'-');
var LocationRec = LocationsObj[Title];
$('#pgEditLocation').data('url', Title);
$('#pgEditLocationDelete').data('href', Title);
$('#pgEditLocationTitle').attr('readonly', 'readonly');
$('#pgEditLocationTitle').attr('data-clear-btn', 'false');
$('#pgEditLocationTitle').val(LocationRec.Title);
$('#pgEditLocationLoc').val(LocationRec.Loc);
};

app.updateLocation = function(LocationRecNew){
// get Location records.
var LocationsObj = app.getLocations();
// lookup specific Location
var Title = LocationRecNew.Title;
Title = Title.replace(/ /g,'-');
var LocationRec = LocationsObj[Title];
// assign new values to read record
LocationRec.Title = LocationRecNew.Title;
LocationRec.Loc = LocationRecNew.Loc;
LocationsObj[Title] = LocationRec;
localStorage['picdemo-locations'] = JSON.stringify(LocationsObj);
// clear the form fields
pgEditLocationClear();
// show the page to display after a record is deleted
$.mobile.changePage('#pgLocation', {transition: 'slide'});
};

app.deleteLocation = function(Title){
// clear the set values// get the Location records from localStorage
var LocationsObj = app.getLocations();
// delete selected Location
delete LocationsObj[Title];
// write it back to localStorage
localStorage['picdemo-locations'] = JSON.stringify(LocationsObj);
// show the page to display after a record is deleted
$.mobile.changePage('#pgLocation', {transition: 'slide'});
};

app.getLocations = function(){
// get Location records
var LocationsObj = localStorage['picdemo-locations'];
if (!LocationsObj){
LocationsObj = {};
localStorage['picdemo-locations'] = JSON.stringify(LocationsObj);
} else {
LocationsObj = JSON.parse(LocationsObj);
}
return LocationsObj;
};

app.displayLocations = function(){
// get Location records.
var LocationsObj = app.getLocations();
// create an empty string to contain html
var html = '';
// make sure your iterators are properly scoped
var n;
// loop over notes
for (n in LocationsObj){
var nLnk = n.replace(/-/g,' ');
html += LocationLi.replace(/ID/g,nLnk).replace(/LINK/g,n);
}
$('#pgLocationList').html(LocationHdr + html).listview('refresh');
};

app.checkForLocationsStorage = function(){
var LocationsObj = app.getLocations();
// are there existing Location records?
if (!$.isEmptyObject(LocationsObj)) {
// yes there are. pass them off to be displayed
app.displayLocations();
} else {
// nope, just show the placeholder
$('#pgLocationList').html(LocationHdr + noLocation).listview('refresh');
}
};

app.Picturesbindings = function(){
$(document).on('click', '#pgPictureList a', function(e){
e.preventDefault();
e.stopImmediatePropagation();
var href = $(this)[0].href.match(/\?.*$/)[0];
var Title = href.replace(/^\?Title=/,'');
$.mobile.changePage('#pgEditPicture', {transition: 'slide'});
app.editPicture(Title);
});

$(document).on('pagebeforechange', function(e, data){
var toPage = data.toPage[0].id;
if(toPage == 'pgPicture'){
// restart the storage check
app.checkForPicturesStorage();
}
});

// bind the back button of the list
$('#pgPictureBack').on('click', function(e){
e.preventDefault();
e.stopImmediatePropagation();
// move to the add new record screen
$.mobile.changePage('#pgMenu', {transition: 'slide'});
});
// click new on listing page
$('#pgPictureNew').on('click', function(e){
e.preventDefault();
e.stopImmediatePropagation();
$('#pgAddPicture').data('from', pgPicture);
// move to the add new record screen
$.mobile.changePage('#pgAddPicture', {transition: 'slide'});
});
// click back button of new record page
$('#pgAddPictureBack').on('click', function(e){
e.preventDefault();
e.stopImmediatePropagation();
//which page are we coming from, if from sign in go back to it
var pgFrom = $('#pgAddPicture').data('from');
switch (pgFrom) {
case "pgSignIn":
$.mobile.changePage('#pgSignIn', {transition: 'slide'});
break;
default:
// go back to the listing screen
$.mobile.changePage('#pgPicture', {transition: 'slide'});
}
});
// click save button of new record
$('#pgAddPictureSave').on('click', function(e){
e.preventDefault();
e.stopImmediatePropagation();
// save the Picture
var PictureRec;
PictureRec = pgAddPictureGetRec();
app.addPicture(PictureRec);
});
// click back button of edit record page
$('#pgEditPictureBack').on('click', function(e){
e.preventDefault();
e.stopImmediatePropagation();
// go back to the listing screen
$.mobile.changePage('#pgPicture', {transition: 'slide'});
});
// click update when editing a record
$('#pgEditPictureUpdate').on('click', function(e){
e.preventDefault();
e.stopImmediatePropagation();
// save the Picture
var PictureRecNew;
PictureRecNew = pgEditPictureGetRec();
app.updatePicture(PictureRecNew);
});
// click delete on edit page
$('#pgEditPictureDelete').on('click', function(e){
e.preventDefault();
e.stopImmediatePropagation();
var Title = $('#pgEditPictureTitle').val();
Title = Title.replace(/-/g,' ');
Title = Title.replace(/-/g,' ');
$('#msgboxheader h1').text('Confirm Delete');
$('#msgboxtitle').text(Title);
$('#msgboxprompt').text('Are you sure that you want to delete this picture?');
$('#msgboxyes').data('method', 'deletePicture');
Title = Title.replace(/ /g,'-');
$('#msgboxyes').data('id', Title);
$('#msgboxno').data('topage', 'pgEditPicture');
$.mobile.changePage('#msgbox', {transition: 'pop'});
});

$('#pgAddPictureImageTakePicture').on('click', function(e){
e.preventDefault();
e.stopImmediatePropagation();
app.pgAddPictureImageGet();
});

$('#pgEditPictureImageTakePicture').on('click', function(e){
e.preventDefault();
e.stopImmediatePropagation();
app.pgEditPictureImageGet();
});



};
//get the record to be saved and put it in a record array
function pgAddPictureGetRec(){
//define the new record
var PictureRec
PictureRec = {};
PictureRec.Title = $('#pgAddPictureTitle').val();
PictureRec.Image = $('#pgAddPictureImage').val();
return PictureRec;
}

//get the record to be saved and put it in a record array
function pgEditPictureGetRec(){
//define the new record
var PictureRec
PictureRec = {};
PictureRec.Title = $('#pgEditPictureTitle').val();
PictureRec.Image = $('#pgEditPictureImage').val();
return PictureRec;
}

//clear the forms for new data entry
function pgAddPictureClear(){
$('#pgAddPictureTitle').val('');
$('#pgAddPictureImage').val('');
}

//clear the forms for new data entry
function pgEditPictureClear(){
$('#pgEditPictureTitle').val('');
$('#pgEditPictureImage').val('');
}

//set camera options
app.pgAddPictureImageGet = function(){
var cameraOptions = {};
cameraOptions.quality = 100;
cameraOptions.destinationType = Camera.DestinationType.FILE_URI;
cameraOptions.encodingType = Camera.EncodingType.PNG;
cameraOptions.sourceType = Camera.PictureSourceType.CAMERA;
cameraOptions.allowEdit = true;
cameraOptions.saveToPhotoAlbum = true;
cameraOptions.cameraDirection = Camera.Direction.BACK;
navigator.camera.getPicture(app.pgAddPictureImageSuccess, app.pgAddPictureImageError, cameraOptions);
};
app.pgAddPictureImageSuccess = function(photoUri){
var img = document.getElementById('pgAddPictureImage');
img.style.display = 'block';
img.src = photoUri;
};

app.pgAddPictureImageError = function(){
};


//set camera options
app.pgEditPictureImageGet = function(){
var cameraOptions = {};
cameraOptions.quality = 100;
cameraOptions.destinationType = Camera.DestinationType.FILE_URI;
cameraOptions.encodingType = Camera.EncodingType.PNG;
cameraOptions.sourceType = Camera.PictureSourceType.CAMERA;
cameraOptions.allowEdit = true;
cameraOptions.saveToPhotoAlbum = true;
cameraOptions.cameraDirection = Camera.Direction.BACK;
navigator.camera.getPicture(app.pgEditPictureImageSuccess, app.pgEditPictureImageError, cameraOptions);
};
app.pgEditPictureImageSuccess = function(photoUri){
var img = document.getElementById('pgEditPictureImage');
img.style.display = 'block';
img.src = photoUri;
};

app.pgEditPictureImageError = function(){
};




app.addPicture = function(PictureRec){
// get Picture records.
var PicturesObj = app.getPictures();
// define a record object to store the current details
var Title = PictureRec.Title;
Title = Title.replace(/ /g,'-');
PicturesObj[Title] = PictureRec;
localStorage['picdemo-pictures'] = JSON.stringify(PicturesObj);
// clear the form fields
pgAddPictureClear();
//which page are we coming from, if from sign in go back to it
var pgFrom = $('#pgAddPicture').data('from');
switch (pgFrom) {
case "pgSignIn":
$.mobile.changePage('#pgSignIn', {transition: 'slide'});
break;
}
};

app.editPicture = function(Title){
// get Picture records.
var PicturesObj = app.getPictures();
// lookup specific Picture
Title = Title.replace(/ /g,'-');
var PictureRec = PicturesObj[Title];
$('#pgEditPicture').data('url', Title);
$('#pgEditPictureDelete').data('href', Title);
$('#pgEditPictureTitle').attr('readonly', 'readonly');
$('#pgEditPictureTitle').attr('data-clear-btn', 'false');
$('#pgEditPictureTitle').val(PictureRec.Title);
$('#pgEditPictureImage').val(PictureRec.Image);
};

app.updatePicture = function(PictureRecNew){
// get Picture records.
var PicturesObj = app.getPictures();
// lookup specific Picture
var Title = PictureRecNew.Title;
Title = Title.replace(/ /g,'-');
var PictureRec = PicturesObj[Title];
// assign new values to read record
PictureRec.Title = PictureRecNew.Title;
PictureRec.Image = PictureRecNew.Image;
PicturesObj[Title] = PictureRec;
localStorage['picdemo-pictures'] = JSON.stringify(PicturesObj);
// clear the form fields
pgEditPictureClear();
// show the page to display after a record is deleted
$.mobile.changePage('#pgPicture', {transition: 'slide'});
};

app.deletePicture = function(Title){
// clear the set values// get the Picture records from localStorage
var PicturesObj = app.getPictures();
// delete selected Picture
delete PicturesObj[Title];
// write it back to localStorage
localStorage['picdemo-pictures'] = JSON.stringify(PicturesObj);
// show the page to display after a record is deleted
$.mobile.changePage('#pgPicture', {transition: 'slide'});
};

app.getPictures = function(){
// get Picture records
var PicturesObj = localStorage['picdemo-pictures'];
if (!PicturesObj){
PicturesObj = {};
localStorage['picdemo-pictures'] = JSON.stringify(PicturesObj);
} else {
PicturesObj = JSON.parse(PicturesObj);
}
return PicturesObj;
};

app.displayPictures = function(){
// get Picture records.
var PicturesObj = app.getPictures();
// create an empty string to contain html
var html = '';
// make sure your iterators are properly scoped
var n;
// loop over notes
for (n in PicturesObj){
var nLnk = n.replace(/-/g,' ');
html += PictureLi.replace(/ID/g,nLnk).replace(/LINK/g,n);
}
$('#pgPictureList').html(PictureHdr + html).listview('refresh');
};

app.checkForPicturesStorage = function(){
var PicturesObj = app.getPictures();
// are there existing Picture records?
if (!$.isEmptyObject(PicturesObj)) {
// yes there are. pass them off to be displayed
app.displayPictures();
} else {
// nope, just show the placeholder
$('#pgPictureList').html(PictureHdr + noPicture).listview('refresh');
}
};

app.BindDevice = function(){
document.addEventListener('deviceready', app.onDeviceReady, false);
};

app.onDeviceReady = function(){
pictureSource = navigator.camera.PictureSourceType;
destinationType = navigator.camera.DestinationType;
isPhoneGapReady = true;
};


app.init();
})(PicDemo);
});

</script>
</body>
</html>
